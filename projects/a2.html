<!DOCTYPE HTML>
<!--
  Editorial by HTML5 UP
  html5up.net | @ajlkn
  Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
  <head>
    <title>Project 2: Potential Field Control - ROB 102</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="../assets/css/main.css" />
    <link rel="shortcut icon" type="image/png" href="../images/mbot_overhead.png"/>

    <!-- Syntax highlighting -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/stackoverflow-light.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js"></script>
  </head>
  <body class="is-preload">

    <!-- Wrapper -->
      <div id="wrapper">

        <!-- Main -->
          <div id="main">
            <div class="inner">

              <!-- Header -->
                <header id="header">
                  <a href="../index.html" class="logo"><strong>ROB 102:</strong> Introduction to AI and Programming</a>
                  <ul class="icons">
                    <li><a href="#" class="icon brands fa-slack"><span class="label">Slack</span></a></li>
                    <li><a href="#" class="icon brands fa-github"><span class="label">Github</span></a></li>
                  </ul>
                </header>

              <!-- Content -->
                <section>
                  <header class="main project">
                    <strong>Project 2:</strong> Potential Field Control
                  </header>

                  <p>In <a href="a1.html">Project 1</a>, we saw that we can control the robot to maintain a goal distance to the wall by correcting our control signals based on the sensor data we observe. We say that our wall following controller was <emph>maintaining a setpoint</emph>, in this case, maintaining a specific goal distance from the wall. A common problem for an autonomous robot is to drive to a goal location (like we did in <a href="a0.html">Project 0</a>!). We could try using our setpoint controller to drive to a goal, but it won't work if there's an obstacle in the way.</p>

                  <p><span class="image left"><img src="../images/potential_field.png" alt=""/></span>
                    Another way we can drive to a goal autonomously is to use <strong>potential field control</strong>. We can imagine that our goal is a magnet, pulling the robot towards it. We can treat obstacles like repelling forces, pushing the robot away. If we combine these two forces, we might get a potential field that looks like the example on the left. To get to the goal, our robot can follow the path of least resistance, moving in the direction of the strongest force at its location at each time step. Another way to say this is that our robot is following the steepest slope, or <emph>gradient</emph>, of the field. This algorithm is called <strong>gradient descent</strong>.</p>

                  <p>For this project, you will write code in C++ to calculate the potential fields the robot needs to reach a goal without colliding with any obstacles. You will be given a map which tells you where the obstacles are, along with a start and goal position. One field should draw the robot towards the goal, and the other should push the robot away from the obstacles. We've made a web app which you can use to develop your code on your computer (see the <a href="../tutorials/app.html">webapp tutorial</a> to get started. Once your algorithm is working, you can <a href="#robot_instructions">try it out on the robot!</a></p>

                  <hr class="major" />

                  <h2 id="description">Project Description</h2>

                  <p>By the end of this project, you will have implemented a distance transform, which will calculate the distance from each cell to the nearest obstacle. It should look something like the image below. The grey cells represent smaller distances to the nearest obstacle, and the white cells represent higher distances.</p>

                  <span class="image main"><img src="../images/dist_tf.png" alt="" style="max-width:600px;"/></span>

                  <h3 id="sec_prereqs">Prerequisites</h3>

                  <p>Before you start, make sure you have followed the <a href="../tutorials/setup.html">setup instructions</a>. We will be compiling and executing all the code in a Docker container.</p>

                  <h4>Getting the code</h4>

                  <p>You will create a Git repository to store your code based off the provided template, as in previous projects. Navigate to the template code <a href="https://github.com/janapavlasek/rob102-path-planning-template">here</a> and create a repository using the template. Remember to <b>make sure it is set to private</b>. Storing your assignment solutions in a public repository is a violation of the honor code. Give Prof. Jenkins and Jana access to your code using their usernames, <code>ohseejay</code> and <code>janapavlasek</code>. Finally, clone your new repository on your computer, substituting the address to your repo:</p>
                  <pre><code class="language-bash">git clone &lt;ADDRESS&gt;</code></code></pre>
                  <p>If you need to refresh your memory, refer to the <a href="a0.html#getting_code">instructions from Project 0</a> for more details about this step.</p>

                  <h4>Webapp tutorial</h4>

                  <p>Review the <a href="../tutorials/app.html">webapp tutorial</a> and make sure that you can run the webapp in the Docker container before continuing with this assignment.</p>

                  <h3>Representing a map in code</h3>

                  <p>Imagine a robot is in an environment like the one shown below. The dark grey cells are obstacles. The robot is equipped with a mapping system so it has knowledge of where the obstacles are.</p>

                  <span class="image main"><img src="../images/grid_graph/map_no_grid.png" alt="" style="max-width:400px;"/></span>

                  <p>We want to find a way to represent the map of this scene as a computational structure. We start by drawing a grid on our map. Then, we will mark each cell with an obstacle in it as <emph>occupied</emph> (gray), and each cell without an obstacle as <emph>free</emph> (white).</p>

                  <span class="image main"><img src="../images/grid_graph/map_as_grid.png" alt="" style="max-width:800px;"/></span>

                  <p>The mapping system gives each cell an <emph>odds value</emph>, in the range <code>[-128, 127]</code>, which represents how likely it is that the cell is occupied. If the value is high, the odds that the cell is occupied is high. Low odds values mean the cell is likely to be free. Each cell has a corresponding coordinate in the grid, which is represented by its <emph>row</emph> and <emph>column</emph>. We refer to the cell by its coordinate <code>(i,j)</code>, where <code>i</code> is the cell's row, and <code>j</code> is the column.</p>

                  <span class="image main"><img src="../images/grid_graph/map_odds.png" alt="" style="max-width:500px;"/></span>

                  <p>Next, we need a way to store the cell odds data in code. We will use an array to do this. To store our two dimensional grid as a single array, we will line up each row end to end. Cell <code>(0,0)</code> will be stored at array index <code>0</code>, cell <code>(0, 1)</code> at index <code>1</code>, and cell <code>(1, 0)</code> at index <code>10</code>. The resulting array will look like this:</p>

                  <span class="image main"><img src="../images/grid_graph/cell_odds.png" alt=""/></span>

                  <h3>The <code>GridGraph</code> Struct</h3>

                  <p>Information about the map for a particular environment is stored in a provided struct called <code>GridGraph</code>. You can visualize the available maps by selecting &quotChoose File&quot in the app, and choosing one of the maps from the <code>data</code> folder in the code (choose a file with the <code>.map</code> extension, not <code>.png</code>). When you click &quotUpload Map&quot, you should see the map in displayed in the app. The struct is defined in the header file <code>include/path_planning/grid_graph.h</code>. The template code looks like this:</p>
                  <pre><code class="language-cpp">struct GridGraph
{
    GridGraph() :
        width(-1),
        height(-1),
        origin_x(0),
        origin_y(0),
        meters_per_cell(0),
        collision_radius(0.15),
        threshold(-100)
    {
    };

    int width, height;
    double origin_x, origin_y, meters_per_cell;
    double collision_radius;
    int8_t threshold;
    std::vector&lt;int8_t&gt; cell_odds;
};</code></pre>

                  <p>The member variables <code>width</code> and <code>height</code> store the graph width and height, in cells. The variables <code>origin_x</code> and <code>origin_y</code> correspond to the global position in meters of the cell <code>(0, 0)</code>. This allows us to determine where the origin of the map is. The variable <code>meters_per_cell</code> contains the size of each cell, in meters. Finally, the <code>cell_odds</code> variable is a vector containing the odds value of each cell, as described above.</p>

                  <ul class="todo">
                    <li class="icon solid fa-laptop-code">In the <code>graph_utils.cpp</code> file, complete function <code>cellToIdx()</code>. It should accept a cell coordinate and a graph as arguments, and return an <code>int</code> containing the corresponding array index for the cell.</li>
                    <li class="icon solid fa-laptop-code">In the <code>graph_utils.cpp</code> file, complete function <code>idxToCell()</code>. It should accept an array index and a graph as arguments, and return a <code>Cell</code> containing the corresponding cell coordinate for the array index.</li>
                  </ul>

                  <p>We have provided a test script to check your indexing functions. Compile your code in the Docker container (using the <a href="../tutorials/app.html#write_code">instructions in the tutorial</a>), then run the test script in the Docker like this:</p>
                  <pre><code class="language-bash">cd build
./path_planning/test_graph</code></pre>

                  <p>The first test (map indexing) should pass before you move on to the next step. The last test (finding neighbors) will not pass at this point. You will complete the functions for that test in <a href="a3.html">Project 3</a>.</p>

                  <h3>The Distance Transform</h3>

                  <p>We will be implementing a <strong>binary distance transform</strong>, which calculates the distance from each cell to the nearest occupied cell. We will use the Euclidean distance as the distance function. We will need a function to calculate the Euclidean distance between two cells. We will also need to modify the <code>GridGraph</code> struct to include a vector called <code>obstacle_distances</code>, which will store the distance to the nearest obstacle for each cell. For occupied cells, the distance should be zero.</p>

                  <ul class="todo">
                    <li class="icon solid fa-laptop-code">In the <code>graph_utils.cpp</code> file, complete function <code>distanceBetweenCells()</code>. It should accept two cell coordinates and return a <code>float</code> representing the Euclidean distance between them.</li>
                    <li class="icon solid fa-laptop-code">In the <code>graph_utils.cpp</code> file, complete function <code>initGraph()</code> to initialize <code>obstacle_distances</code>. You can assume the graph will be loaded when the function is called.</li>
                  </ul>

                  <ul class="hint">
                    <li class="icon solid fa-cogs"><strong>Hint:</strong> Initialize <code>obstacle_distances</code> so that its length is the same as the number of cells in the graph, and set all the values to a very big number (like <code>HIGH</code>, which is defined in <code>GridGraph</code>).</li>
                    <li class="icon solid fa-cogs"><strong>Hint:</strong> This code creates a vector of length 10 and initializes all the elements to 1.02, and assigns the result to an existing vector <code>v</code>:
                    <pre><code class="language-cpp">v = std::vector&lt;float&gt;(10, 1.02);</code></pre></li>
                  </ul>

                  <p>The test script provides a test to check your distance function. This test should pass before moving on.</p>

                  <h3>The Naive Distance Transform</h3>

                  <p>We will start by implementing a distance transform with complexity <i>O(N<sup>2</sup>)</i>, where <i>N</i> is the number of cells in the graph. For each cell, calculate the distance between the current cell and every occupied cell in the graph. Store the smallest distance in the <code>obstacle_distances</code> vector. This is the naive implementation because it doesn't use any tricks to perform the transform more quickly. The complexity is <i>O(N<sup>2</sup>)</i> because the algorithm needs to loop through <i>N</i> cells for each of the <i>N</i> cells, resulting in <i>N*N = N<sup>2</sup></i> operations. You should notice that this takes a lot of time for big graphs!</p>

                  <ul class="todo">
                    <li class="icon solid fa-laptop-code">In the <code>potential_field/distance_transform.cpp</code> file, complete function <code>distanceTransformSlow()</code>. It should accept a graph and populate the <code>obstacle_distances</code> vector with the distance to the nearest occupied cell.</li>
                  </ul>

                  <ul class="hint">
                    <li class="icon solid fa-cogs"><strong>Hint:</strong> Use your indexing functions to convert between Cell types and indexes, and your distance function to calculate distances between cells.</li>
                    <li class="icon solid fa-cogs"><strong>Hint:</strong> Can you make your algorithm any faster?</li>
                  </ul>

                  <p>The test script includes a test to check that your distance transform is correct for the small test graph. This test should pass before you move on. However, you should make sure to test your algorithm on multiple different maps! You can use the webapp to visualize the distances as a gradient. It should look like the image at the beginning of this page.</p>

                  <h3>The Linear Distance Transform</h3>

                  <p>TODO</p>

                  <hr class="major" />

                  <h2 id="robot_instructions">Running your code on the robot</h2>
                  <p>Donec eget ex magna. Interdum et malesuada fames ac ante ipsum primis in faucibus. Pellentesque venenatis dolor imperdiet dolor mattis sagittis. Praesent rutrum sem diam, vitae egestas enim auctor sit amet. Pellentesque leo mauris, consectetur id ipsum sit amet, fergiat. Pellentesque in mi eu massa lacinia malesuada et a elit. Donec urna ex, lacinia in purus ac, pretium pulvinar mauris. Curabitur sapien risus, commodo eget turpis at, elementum convallis elit. Pellentesque enim turpis, hendrerit.</p>
                  <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis dapibus rutrum facilisis. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Etiam tristique libero eu nibh porttitor fermentum. Nullam venenatis erat id vehicula viverra. Nunc ultrices eros ut ultricies condimentum. Mauris risus lacus, blandit sit amet venenatis non, bibendum vitae dolor. Nunc lorem mauris, fringilla in aliquam at, euismod in lectus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. In non lorem sit amet elit placerat maximus. Pellentesque aliquam maximus risus, vel sed vehicula.</p>

                </section>

            </div>
          </div>

        <!-- Sidebar -->
          <div id="sidebar">
            <div class="inner">

              <!-- Menu -->
                <nav id="menu">
                  <header class="major">
                    <h2>Menu</h2>
                  </header>
                  <ul>
                    <li><a href="../index.html">Home</a></li>
                    <li>
                      <span class="opener">Course Information</span>
                      <ul>
                        <li><a href="../index.html#sec_schedule">Schedule</a></li>
                        <li><a href="../index.html#sec_course_staff">Course Staff</a></li>
                        <li><a href="../syllabus.html">Syllabus</a></li>
                      </ul>
                    </li>
                    <li>
                      <span class="opener active">Projects</span>
                      <ul>
                        <li><a href="a0.html">Project 0: Intro to C++</a></li>
                        <li><a href="a1.html">Project 1: Wall Following</a></li>
                        <li><a href="a2.html">Project 2: Potential Field Control</a></li>
                        <li><a href="a3.html">Project 3: Path Planning</a></li>
                        <li><a href="a4.html">Project 4: Machine Learning</a></li>
                      </ul>
                    </li>
                    <li>
                      <span class="opener">Tutorials</span>
                      <ul>
                        <li><a href="../tutorials/setup.html">Computer Setup</a></li>
                        <li><a href="../tutorials/git.html">Github</a></li>
                        <li><a href="../tutorials/robot.html">Using the MBot-Omni</a></li>
                        <li><a href="../tutorials/app.html">Using the Webapp</a></li>
                      </ul>
                    </li>
                  </ul>
                </nav>

              <!-- Section -->
                <section>
                  <header class="major">
                    <h2>Course Times</h2>
                  </header>
                  <p>Lectures, labs and office hours.</p>
                  <ul class="contact">
                    <li class="icon solid fa-chalkboard-teacher">MW 10-11:30 AM @ GFL 107</li>
                    <li class="icon solid fa-vials">F 12-2 PM (002) @ FRB 1060 <br/>F 2-4 PM (003)  @ FRB 1060</li>
                    <li class="icon solid fa-users">TBD</li>
                  </ul>
                </section>

              <!-- Footer -->
                <!-- <footer id="footer">
                  <p class="copyright">&copy; Untitled. All rights reserved. Demo Images: <a href="https://unsplash.com">Unsplash</a>. Design: <a href="https://html5up.net">HTML5 UP</a>.</p>
                </footer> -->

            </div>
          </div>

      </div>

    <!-- Scripts -->
      <script src="../assets/js/jquery.min.js"></script>
      <script src="../assets/js/browser.min.js"></script>
      <script src="../assets/js/breakpoints.min.js"></script>
      <script src="../assets/js/util.js"></script>
      <script src="../assets/js/main.js"></script>
      <script>hljs.highlightAll();</script>

  </body>
</html>
